<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.82.0"><meta name=description content="Tutorial website for FXGL"><meta name=author content="Mazela-Man"><link rel=icon href=/mazela-man-web/assets/favicon.ico type=image/ico><title>02. Physics - Mazela-Man FXGL Tutorial</title><link href=/mazela-man-web/css/nucleus.css?1617213882 rel=stylesheet><link href=/mazela-man-web/css/fontawesome-all.min.css?1617213882 rel=stylesheet><link href=/mazela-man-web/css/hybrid.css?1617213882 rel=stylesheet><link href=/mazela-man-web/css/featherlight.min.css?1617213882 rel=stylesheet><link href=/mazela-man-web/css/perfect-scrollbar.min.css?1617213882 rel=stylesheet><link href=/mazela-man-web/css/auto-complete.css?1617213882 rel=stylesheet><link href=/mazela-man-web/css/atom-one-dark-reasonable.css?1617213882 rel=stylesheet><link href=/mazela-man-web/css/theme.css?1617213882 rel=stylesheet><link href=/mazela-man-web/css/hugo-theme.css?1617213882 rel=stylesheet><link href=/mazela-man-web/css/theme-red.css?1617213882 rel=stylesheet><script src=/mazela-man-web/js/jquery-3.3.1.min.js?1617213882></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=/mazela-man-web/02_physics/><nav id=sidebar><div id=header-wrapper><div id=header><a id=logo href=https://dykstrom.github.io/mazela-man-web/home/><img src=https://dykstrom.github.io/mazela-man-web/images/07/cherries-live.png></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=/mazela-man-web/js/lunr.min.js?1617213882></script><script type=text/javascript src=/mazela-man-web/js/auto-complete.js?1617213882></script><script type=text/javascript>var baseurl="https://dykstrom.github.io/mazela-man-web/"</script><script type=text/javascript src=/mazela-man-web/js/search.js?1617213882></script></div><div class=highlightable><ul class=topics><li data-nav-id=/mazela-man-web/home/ title=Mazela-Man class=dd-item><a href=/mazela-man-web/home/>Mazela-Man</a></li><li data-nav-id=/mazela-man-web/introduction/ title=Introduction class=dd-item><a href=/mazela-man-web/introduction/>Introduction</a></li><li data-nav-id=/mazela-man-web/01_handling_input/ title="01. Handling input" class=dd-item><a href=/mazela-man-web/01_handling_input/>01. Handling input</a></li><li data-nav-id=/mazela-man-web/02_physics/ title="02. Physics" class="dd-item
parent
active"><a href=/mazela-man-web/02_physics/>02. Physics</a></li><li data-nav-id=/mazela-man-web/03_eating_and_keeping_score/ title="03. Eating and Keeping Score" class=dd-item><a href=/mazela-man-web/03_eating_and_keeping_score/>03. Eating and Keeping Score</a></li><li data-nav-id=/mazela-man-web/04_animation/ title="04. Animation" class=dd-item><a href=/mazela-man-web/04_animation/>04. Animation</a></li><li data-nav-id=/mazela-man-web/05_adding_enemies/ title="05. Adding Enemies" class=dd-item><a href=/mazela-man-web/05_adding_enemies/>05. Adding Enemies</a></li><li data-nav-id=/mazela-man-web/06_second_level/ title="06. A Second Level" class=dd-item><a href=/mazela-man-web/06_second_level/>06. A Second Level</a></li><li data-nav-id=/mazela-man-web/07_bonus_points/ title="07. Bonus Points" class=dd-item><a href=/mazela-man-web/07_bonus_points/>07. Bonus Points</a></li><li data-nav-id=/mazela-man-web/08_adding_sound/ title="08. Adding Sound" class=dd-item><a href=/mazela-man-web/08_adding_sound/>08. Adding Sound</a></li><li data-nav-id=/mazela-man-web/09_enable_main_menu/ title="09. Enable Main Menu" class=dd-item><a href=/mazela-man-web/09_enable_main_menu/>09. Enable Main Menu</a></li><li data-nav-id=/mazela-man-web/10_end_of_tutorial/ title="10. End of Tutorial" class=dd-item><a href=/mazela-man-web/10_end_of_tutorial/>10. End of Tutorial</a></li></ul><section id=footer><p>Built with <a href=https://github.com/matcornic/hugo-theme-learn><i class="fas fa-heart"></i></a> from <a href=https://getgrav.org>Grav</a> and <a href=https://gohugo.io/>Hugo</a></p></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span>
<span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links><a href=/mazela-man-web/>Home</a> > 02. Physics</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><ul><li><a href=#wall-entities>Wall Entities</a></li><li><a href=#player-entity>Player Entity</a></li><li><a href=#gravity-and-forces>Gravity and Forces</a></li></ul></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>02. Physics</h1><p>The reason the player can move through the walls is that the walls do not &ldquo;exist&rdquo; in the game.
As of now, they are only images, and not entities. To fix this we are going to create objects
for the walls in Tiled.</p><p>As before, if you don&rsquo;t want to use Tiled, you can copy the level file from the
<a href=https://github.com/dykstrom/mazela-man/blob/main/03-chapter-3/src/main/resources/assets/levels/level1.tmx>next chapter</a>. The tilemap is
still the same.</p><p>Start Tiled and open the level file for the current chapter. Select the Object Layer in the
Layers area, and start adding objects for the walls on top of the tiles. Try to make the wall
objects fit as close as possible to the wall tiles. That becomes easier if you set snapping
to &ldquo;Snap to pixels&rdquo; in View&ndash;>Snapping.</p><p>Here is a closeup of a part of my level including objects for the walls.</p><p><img src=https://dykstrom.github.io/mazela-man-web/images/02/wall-objects.png alt="Wall Objects"></p><p>Note that you need to set the type string of all wall objects to &ldquo;Wall&rdquo; in the property editor.
This type string will again be used in the entity factory to spawn the correct entity.</p><p><img src=https://dykstrom.github.io/mazela-man-web/images/02/wall-properties.png alt="Wall Properties"></p><p>Remember to save the level file when you are done with the walls.</p><h3 id=wall-entities>Wall Entities</h3><p>Now that we have added the walls as objects in the level file, we again turn our attention to
the entity factory. Let&rsquo;s add a spawn method for walls.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>    <span style=color:#a6e22e>@Spawns</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Wall&#34;</span><span style=color:#f92672>)</span>
    <span style=color:#66d9ef>public</span> Entity <span style=color:#a6e22e>spawnWall</span><span style=color:#f92672>(</span>SpawnData data<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>return</span> FXGL<span style=color:#f92672>.</span><span style=color:#a6e22e>entityBuilder</span><span style=color:#f92672>(</span>data<span style=color:#f92672>)</span>
                <span style=color:#f92672>.</span><span style=color:#a6e22e>type</span><span style=color:#f92672>(</span>EntityType<span style=color:#f92672>.</span><span style=color:#a6e22e>WALL</span><span style=color:#f92672>)</span>
                <span style=color:#f92672>.</span><span style=color:#a6e22e>bbox</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> HitBox<span style=color:#f92672>(</span>BoundingShape<span style=color:#f92672>.</span><span style=color:#a6e22e>box</span><span style=color:#f92672>(</span>data<span style=color:#f92672>.&lt;</span>Integer<span style=color:#f92672>&gt;</span>get<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;width&#34;</span><span style=color:#f92672>),</span> data<span style=color:#f92672>.&lt;</span>Integer<span style=color:#f92672>&gt;</span>get<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;height&#34;</span><span style=color:#f92672>))))</span>
                <span style=color:#f92672>.</span><span style=color:#a6e22e>with</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> PhysicsComponent<span style=color:#f92672>())</span>
                <span style=color:#f92672>.</span><span style=color:#a6e22e>build</span><span style=color:#f92672>();</span>
    <span style=color:#f92672>}</span>
</code></pre></div><p>We annotate this method with <code>@Spawn("Wall")</code> to match it with what is in the level file. We set
the entity type to <code>EntityType.WALL</code>, which means we also need to add that enum constant to
the enum <code>EntityType</code>. We create a bounding box for the wall entity using data from the
<code>SpawnData</code>. The width and height read from <code>SpawnData</code> are of course the width and height we
saw in the Tiled property editor. Note that wall entities do not have any view. They are
invisible entities, and that is because we drew them using tiles in Tiled. Entities that remain in
the same position during the entire level can be drawn in the Tiled editor, while entities that
move, or appear and disappear again, must be created with a view when they are created by the
entity factory.</p><p>The last thing to note about the new spawn method is that we give the entity a <code>PhysicsComponent</code>.
FXGL is highly componentized, you can add any number of predefined or custom components to an
entity. All components will receive callbacks when they are added or removed, and on each frame
during game play. In a later chapter we will create a custom component, but the <code>PhysicsComponent</code>
is one of the predefined components.</p><p>Adding a <code>PhysicsComponent</code> to an entity means giving up control of the entity. It will now be
managed by the physics engine. You can no longer move the entity by calling the translate
methods. Instead, you will have to work with forces and velocities. It also means that the
entity will interact with other entities managed by the physics engine. We will use that by
also letting the player entity be managed by the physics engine.</p><h3 id=player-entity>Player Entity</h3><p>Adding a <code>PhysicsComponent</code> for the player entity is a bit more complicated, because we want to
set some properties of the player body at the same time. FXGL uses <a href=https://github.com/jbox2d/jbox2d>jbox2d</a>
to deal with physics, and the definitions below all relate to jbox2d. While it is beyond the
scope of this tutorial to explain the entire physics system of FXGL and jbox2d, some important
properties below will be described. There are many more properties to play with if you want.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>    <span style=color:#a6e22e>@Spawns</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Player&#34;</span><span style=color:#f92672>)</span>
    <span style=color:#66d9ef>public</span> Entity <span style=color:#a6e22e>spawnPlayer</span><span style=color:#f92672>(</span>SpawnData data<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        PhysicsComponent physics <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> PhysicsComponent<span style=color:#f92672>();</span>
        physics<span style=color:#f92672>.</span><span style=color:#a6e22e>setFixtureDef</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> FixtureDef<span style=color:#f92672>().</span><span style=color:#a6e22e>friction</span><span style=color:#f92672>(</span>0<span style=color:#f92672>).</span><span style=color:#a6e22e>density</span><span style=color:#f92672>(</span>0<span style=color:#f92672>.</span><span style=color:#a6e22e>1f</span><span style=color:#f92672>));</span>
        BodyDef bd <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> BodyDef<span style=color:#f92672>();</span>
        bd<span style=color:#f92672>.</span><span style=color:#a6e22e>setFixedRotation</span><span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>);</span>
        bd<span style=color:#f92672>.</span><span style=color:#a6e22e>setType</span><span style=color:#f92672>(</span>BodyType<span style=color:#f92672>.</span><span style=color:#a6e22e>DYNAMIC</span><span style=color:#f92672>);</span>
        physics<span style=color:#f92672>.</span><span style=color:#a6e22e>setBodyDef</span><span style=color:#f92672>(</span>bd<span style=color:#f92672>);</span>

        <span style=color:#66d9ef>return</span> FXGL<span style=color:#f92672>.</span><span style=color:#a6e22e>entityBuilder</span><span style=color:#f92672>(</span>data<span style=color:#f92672>)</span>
                <span style=color:#f92672>.</span><span style=color:#a6e22e>type</span><span style=color:#f92672>(</span>EntityType<span style=color:#f92672>.</span><span style=color:#a6e22e>PLAYER</span><span style=color:#f92672>)</span>
                <span style=color:#f92672>.</span><span style=color:#a6e22e>viewWithBBox</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;player.png&#34;</span><span style=color:#f92672>)</span>
                <span style=color:#f92672>.</span><span style=color:#a6e22e>with</span><span style=color:#f92672>(</span>physics<span style=color:#f92672>)</span>
                <span style=color:#f92672>.</span><span style=color:#a6e22e>build</span><span style=color:#f92672>();</span>
    <span style=color:#f92672>}</span>
</code></pre></div><p>We create a <code>PhysicsComponent</code>, and set a fixture on it. Fixtures contain some
non-geometrical properties of physics bodies that are used for collision detection. We set
the friction to 0, which means the player will glide along the walls. When you have completed
this chapter, and have a working physics world, you can try to set the friction to something
else, for example 0.5f, and notice what happens!</p><p>Next, we create a body definition that holds data used to create a rigid body.
By setting fixed rotation to true we prevent the body (that is, the player) from rotating when
it collides with another body, and by setting the body type to <code>DYNAMIC</code>, we get a body that
has a velocity determined by forces and is moved by the physics engine.</p><p>Finally, we give the configured <code>PhysicsComponent</code> to the entity builder to attach it to the
player entity.</p><h3 id=gravity-and-forces>Gravity and Forces</h3><p>The physics world is ruled by forces, and one of the forces that is usually present is
gravity. However, we don&rsquo;t want any gravity in this game, so we will set it to zero. We can
initialize the physics world by overriding yet another method from <code>GameApplication</code>, this time
the method `initPhysics (surprise, surprise). We set the gravity both horizontally and
vertically to zero. Later, you can try setting it to something else, and observe the force
of gravity.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>    <span style=color:#a6e22e>@Override</span>
    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>initPhysics</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
        FXGL<span style=color:#f92672>.</span><span style=color:#a6e22e>getPhysicsWorld</span><span style=color:#f92672>().</span><span style=color:#a6e22e>setGravity</span><span style=color:#f92672>(</span>0<span style=color:#f92672>,</span> 0<span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span>
</code></pre></div><p>As noted before, we cannot move the player entity manually any longer, when it is managed by
the physics engine. Instead, we give the entity a velocity and watch it move automatically.
Let&rsquo;s rewrite the input handlers to access the <code>PhysicsComponent</code> of the player entity, and set
a velocity on it.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>    <span style=color:#a6e22e>@Override</span>
    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>initInput</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
        FXGL<span style=color:#f92672>.</span><span style=color:#a6e22e>onKey</span><span style=color:#f92672>(</span>KeyCode<span style=color:#f92672>.</span><span style=color:#a6e22e>A</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;Move Left&#34;</span><span style=color:#f92672>,</span> <span style=color:#f92672>()</span> <span style=color:#f92672>-&gt;</span> getPlayer<span style=color:#f92672>().</span><span style=color:#a6e22e>getComponent</span><span style=color:#f92672>(</span>PhysicsComponent<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>).</span><span style=color:#a6e22e>setVelocityX</span><span style=color:#f92672>(-</span>SPEED<span style=color:#f92672>));</span>
        FXGL<span style=color:#f92672>.</span><span style=color:#a6e22e>onKey</span><span style=color:#f92672>(</span>KeyCode<span style=color:#f92672>.</span><span style=color:#a6e22e>D</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;Move Right&#34;</span><span style=color:#f92672>,</span> <span style=color:#f92672>()</span> <span style=color:#f92672>-&gt;</span> getPlayer<span style=color:#f92672>().</span><span style=color:#a6e22e>getComponent</span><span style=color:#f92672>(</span>PhysicsComponent<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>).</span><span style=color:#a6e22e>setVelocityX</span><span style=color:#f92672>(</span>SPEED<span style=color:#f92672>));</span>
        FXGL<span style=color:#f92672>.</span><span style=color:#a6e22e>onKey</span><span style=color:#f92672>(</span>KeyCode<span style=color:#f92672>.</span><span style=color:#a6e22e>W</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;Move Up&#34;</span><span style=color:#f92672>,</span> <span style=color:#f92672>()</span> <span style=color:#f92672>-&gt;</span> getPlayer<span style=color:#f92672>().</span><span style=color:#a6e22e>getComponent</span><span style=color:#f92672>(</span>PhysicsComponent<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>).</span><span style=color:#a6e22e>setVelocityY</span><span style=color:#f92672>(-</span>SPEED<span style=color:#f92672>));</span>
        FXGL<span style=color:#f92672>.</span><span style=color:#a6e22e>onKey</span><span style=color:#f92672>(</span>KeyCode<span style=color:#f92672>.</span><span style=color:#a6e22e>S</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;Move Down&#34;</span><span style=color:#f92672>,</span> <span style=color:#f92672>()</span> <span style=color:#f92672>-&gt;</span> getPlayer<span style=color:#f92672>().</span><span style=color:#a6e22e>getComponent</span><span style=color:#f92672>(</span>PhysicsComponent<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>).</span><span style=color:#a6e22e>setVelocityY</span><span style=color:#f92672>(</span>SPEED<span style=color:#f92672>));</span>
    <span style=color:#f92672>}</span>
</code></pre></div><p>The constant <code>SPEED</code> is now a velocity, and not a number of pixels to move, so it has to be
updated too. A suitable value for the new <code>SPEED</code> constant could be 150.</p><p>When we run the game again, we can see that the player continues moving in the same direction
until it is stopped by a wall. That is because there is no friction, and no gravity affecting
it.</p><p>This is the end of chapter 2. In the <a href=https://dykstrom.github.io/mazela-man-web/03_eating_and_keeping_score/>next chapter</a> we will make
the game a bit more interesting by adding something for the player to eat.</p><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=/mazela-man-web/01_handling_input/ title="01. Handling input"><i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=/mazela-man-web/03_eating_and_keeping_score/ title="03. Eating and Keeping Score" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/mazela-man-web/js/clipboard.min.js?1617213882></script><script src=/mazela-man-web/js/perfect-scrollbar.min.js?1617213882></script><script src=/mazela-man-web/js/perfect-scrollbar.jquery.min.js?1617213882></script><script src=/mazela-man-web/js/jquery.sticky.js?1617213882></script><script src=/mazela-man-web/js/featherlight.min.js?1617213882></script><script src=/mazela-man-web/js/highlight.pack.js?1617213882></script><script>hljs.initHighlightingOnLoad()</script><script src=/mazela-man-web/js/modernizr.custom-3.6.0.js?1617213882></script><script src=/mazela-man-web/js/learn.js?1617213882></script><script src=/mazela-man-web/js/hugo-learn.js?1617213882></script><script src=/mazela-man-web/mermaid/mermaid.js?1617213882></script><script>mermaid.initialize({startOnLoad:!0})</script></body></html>