<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.82.0"><meta name=description content="Tutorial website for FXGL"><meta name=author content="Mazela-Man"><link rel=icon href=/mazela-man-web/assets/favicon.ico type=image/ico><title>03. Eating and Keeping Score - Mazela-Man FXGL Tutorial</title><link href=/mazela-man-web/css/nucleus.css?1617196794 rel=stylesheet><link href=/mazela-man-web/css/fontawesome-all.min.css?1617196794 rel=stylesheet><link href=/mazela-man-web/css/hybrid.css?1617196794 rel=stylesheet><link href=/mazela-man-web/css/featherlight.min.css?1617196794 rel=stylesheet><link href=/mazela-man-web/css/perfect-scrollbar.min.css?1617196794 rel=stylesheet><link href=/mazela-man-web/css/auto-complete.css?1617196794 rel=stylesheet><link href=/mazela-man-web/css/atom-one-dark-reasonable.css?1617196794 rel=stylesheet><link href=/mazela-man-web/css/theme.css?1617196794 rel=stylesheet><link href=/mazela-man-web/css/hugo-theme.css?1617196794 rel=stylesheet><link href=/mazela-man-web/css/theme-red.css?1617196794 rel=stylesheet><script src=/mazela-man-web/js/jquery-3.3.1.min.js?1617196794></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=/mazela-man-web/03_eating_and_keeping_score/><nav id=sidebar><div id=header-wrapper><div id=header><a id=logo href=https://dykstrom.github.io/mazela-man-web/home/><img src=https://dykstrom.github.io/mazela-man-web/images/07/cherries-live.png></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=/mazela-man-web/js/lunr.min.js?1617196794></script><script type=text/javascript src=/mazela-man-web/js/auto-complete.js?1617196794></script><script type=text/javascript>var baseurl="https://dykstrom.github.io/mazela-man-web/"</script><script type=text/javascript src=/mazela-man-web/js/search.js?1617196794></script></div><div class=highlightable><ul class=topics><li data-nav-id=/mazela-man-web/home/ title=Mazela-Man class=dd-item><a href=/mazela-man-web/home/>Mazela-Man</a></li><li data-nav-id=/mazela-man-web/introduction/ title=Introduction class=dd-item><a href=/mazela-man-web/introduction/>Introduction</a></li><li data-nav-id=/mazela-man-web/01_handling_input/ title="01. Handling input" class=dd-item><a href=/mazela-man-web/01_handling_input/>01. Handling input</a></li><li data-nav-id=/mazela-man-web/02_physics/ title="02. Physics" class=dd-item><a href=/mazela-man-web/02_physics/>02. Physics</a></li><li data-nav-id=/mazela-man-web/03_eating_and_keeping_score/ title="03. Eating and Keeping Score" class="dd-item
parent
active"><a href=/mazela-man-web/03_eating_and_keeping_score/>03. Eating and Keeping Score</a></li><li data-nav-id=/mazela-man-web/04_animation/ title="04. Animation" class=dd-item><a href=/mazela-man-web/04_animation/>04. Animation</a></li><li data-nav-id=/mazela-man-web/05_adding_enemies/ title="05. Adding Enemies" class=dd-item><a href=/mazela-man-web/05_adding_enemies/>05. Adding Enemies</a></li><li data-nav-id=/mazela-man-web/06_second_level/ title="06. A Second Level" class=dd-item><a href=/mazela-man-web/06_second_level/>06. A Second Level</a></li><li data-nav-id=/mazela-man-web/07_bonus_points/ title="07. Bonus Points" class=dd-item><a href=/mazela-man-web/07_bonus_points/>07. Bonus Points</a></li><li data-nav-id=/mazela-man-web/08_adding_sounds/ title="08. Adding Sound" class=dd-item><a href=/mazela-man-web/08_adding_sounds/>08. Adding Sound</a></li><li data-nav-id=/mazela-man-web/09_enable_main_menu/ title="09. Enable Main Menu" class=dd-item><a href=/mazela-man-web/09_enable_main_menu/>09. Enable Main Menu</a></li><li data-nav-id=/mazela-man-web/10_end_of_tutorial/ title="10. End of Tutorial" class=dd-item><a href=/mazela-man-web/10_end_of_tutorial/>10. End of Tutorial</a></li></ul><section id=footer><p>Built with <a href=https://github.com/matcornic/hugo-theme-learn><i class="fas fa-heart"></i></a> from <a href=https://getgrav.org>Grav</a> and <a href=https://gohugo.io/>Hugo</a></p></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span>
<span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links><a href=/mazela-man-web/>Home</a> > 03. Eating and Keeping Score</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><ul><li><a href=#adding-pills>Adding Pills</a></li><li><a href=#collision-detection>Collision Detection</a></li><li><a href=#keeping-score>Keeping Score</a></li></ul></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>03. Eating and Keeping Score</h1><p>In this chapter, we will add pills for the player to eat, handle collisions to know when a pill
has been eaten, keep a score of the pills eaten, and display this score in the UI. We start as
usual, in the Tiled editor. A new version of the level file, with pills added, can be copied
from <a href=https://dykstrom.github.io/mazela-man-web/04-chapter-4/src/main/resources/assets/levels/level1.tmx>here</a>.</p><h3 id=adding-pills>Adding Pills</h3><p>Open the level file for this chapter in Tiled, and add objects for as many pills you want in
your level. Make the objects 20x20 pixels in size, like a square in the grid. This will be
easier to do if you set snapping to &ldquo;Snap to Grid&rdquo;. Remember to set the type string of all pill
objects to &ldquo;Pill&rdquo;. As you already know by now, we will use that string in the entity factory.</p><p>This is how my level looks in Tiled after adding all the pills.</p><p><img src=https://dykstrom.github.io/mazela-man-web/images/03/pill-objects.png alt="Pill Objects"></p><p>In the entity factory, we add the corresponding spawn method.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>    <span style=color:#a6e22e>@Spawns</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Pill&#34;</span><span style=color:#f92672>)</span>
    <span style=color:#66d9ef>public</span> Entity <span style=color:#a6e22e>spawnPill</span><span style=color:#f92672>(</span>SpawnData data<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>return</span> FXGL<span style=color:#f92672>.</span><span style=color:#a6e22e>entityBuilder</span><span style=color:#f92672>(</span>data<span style=color:#f92672>)</span>
                <span style=color:#f92672>.</span><span style=color:#a6e22e>type</span><span style=color:#f92672>(</span>EntityType<span style=color:#f92672>.</span><span style=color:#a6e22e>PILL</span><span style=color:#f92672>)</span>
                <span style=color:#f92672>.</span><span style=color:#a6e22e>view</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;pill.png&#34;</span><span style=color:#f92672>)</span>
                <span style=color:#75715e>// Make hit box a little smaller than the tile to fit the visible part of the image
</span><span style=color:#75715e></span>                <span style=color:#f92672>.</span><span style=color:#a6e22e>bbox</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> HitBox<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;PILL_HIT_BOX&#34;</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>new</span> Point2D<span style=color:#f92672>(</span>5<span style=color:#f92672>,</span> 5<span style=color:#f92672>),</span> BoundingShape<span style=color:#f92672>.</span><span style=color:#a6e22e>box</span><span style=color:#f92672>(</span>9<span style=color:#f92672>,</span> 9<span style=color:#f92672>)))</span>
                <span style=color:#f92672>.</span><span style=color:#a6e22e>collidable</span><span style=color:#f92672>()</span>
                <span style=color:#f92672>.</span><span style=color:#a6e22e>build</span><span style=color:#f92672>();</span>
    <span style=color:#f92672>}</span>
</code></pre></div><p>We need to create a new enum constant in <code>EntityType</code>, and we need to copy the pill image to the
textures folder from <a href=https://dykstrom.github.io/mazela-man-web/resources/pill.png>here</a>.</p><p>This time we don&rsquo;t create the bounding box automatically from the image. That is because the
image is 20x20 pixels, but the actual pill is only 9x9 pixels. To make the collision look
better, we instead create a bounding box that is a little smaller than the image, trying to fit
it to the actual pill.</p><p>We also call the <code>collidable</code> method on the builder, which is just a convenience method for
adding a <code>CollidableComponent</code> to the entity. This lets the entity take part in FXGL&rsquo;s own
collision detection. We want the player entity to also be <code>collidable</code>, so we add that call to
the entity builder for the player entity as well.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>        <span style=color:#66d9ef>return</span> FXGL<span style=color:#f92672>.</span><span style=color:#a6e22e>entityBuilder</span><span style=color:#f92672>(</span>data<span style=color:#f92672>)</span>
                <span style=color:#f92672>.</span><span style=color:#a6e22e>type</span><span style=color:#f92672>(</span>EntityType<span style=color:#f92672>.</span><span style=color:#a6e22e>PLAYER</span><span style=color:#f92672>)</span>
                <span style=color:#f92672>.</span><span style=color:#a6e22e>viewWithBBox</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;player.png&#34;</span><span style=color:#f92672>)</span>
                <span style=color:#f92672>.</span><span style=color:#a6e22e>with</span><span style=color:#f92672>(</span>physics<span style=color:#f92672>)</span>
                <span style=color:#f92672>.</span><span style=color:#a6e22e>collidable</span><span style=color:#f92672>()</span>
                <span style=color:#f92672>.</span><span style=color:#a6e22e>build</span><span style=color:#f92672>();</span>
</code></pre></div><h3 id=collision-detection>Collision Detection</h3><p>To facilitate collision detection, we update the <code>initPhysics</code> method to add a collision handler.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>    <span style=color:#a6e22e>@Override</span>
    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>initPhysics</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
        PhysicsWorld physics <span style=color:#f92672>=</span> FXGL<span style=color:#f92672>.</span><span style=color:#a6e22e>getPhysicsWorld</span><span style=color:#f92672>();</span>
        physics<span style=color:#f92672>.</span><span style=color:#a6e22e>setGravity</span><span style=color:#f92672>(</span>0<span style=color:#f92672>,</span> 0<span style=color:#f92672>);</span>
        physics<span style=color:#f92672>.</span><span style=color:#a6e22e>addCollisionHandler</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> CollisionHandler<span style=color:#f92672>(</span>EntityType<span style=color:#f92672>.</span><span style=color:#a6e22e>PLAYER</span><span style=color:#f92672>,</span> EntityType<span style=color:#f92672>.</span><span style=color:#a6e22e>PILL</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
            <span style=color:#a6e22e>@Override</span>
            <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onCollisionBegin</span><span style=color:#f92672>(</span>Entity player<span style=color:#f92672>,</span> Entity pill<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
                pill<span style=color:#f92672>.</span><span style=color:#a6e22e>removeFromWorld</span><span style=color:#f92672>();</span>
            <span style=color:#f92672>}</span>
        <span style=color:#f92672>});</span>
    <span style=color:#f92672>}</span>
</code></pre></div><p>The arguments to the <code>CollisionHandler</code> constructor are the types of entities we want to handle
collisions between. The order is important here. The callback methods, like <code>onCollisionBegin</code>,
will receive their arguments in the same order as specified when calling the constructor. In
our case, we want to handle collisions between the player and a pill. We override the callback
method <code>onCollisionBegin</code> that is called just when a collision between two objects has started.
There are other callbacks like <code>onCollision</code>, that is called every frame while the collision
is happening.</p><p>In the callback method, we simply remove the pill from the game world. That makes the entity
disappear completely, with view and bounding box and all.</p><h3 id=keeping-score>Keeping Score</h3><p>The player should score a number of points for each pill eaten, and we want to keep track of
that score, and display it in the UI. For that we will use a game variable. Game variables
are basically just a map from <code>String</code> to <code>Object</code>, a number of global variables used throughout
the game. In our case, we will only use it in the main app class, but there are benefits with
using game variables that we will take advantage of later.</p><p>We start by initializing the score to 0. That can be done in, you guessed it, the overridden
method <code>initGameVars</code>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>    <span style=color:#a6e22e>@Override</span>
    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>initGameVars</span><span style=color:#f92672>(</span>Map<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>,</span> Object<span style=color:#f92672>&gt;</span> vars<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        vars<span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;score&#34;</span><span style=color:#f92672>,</span> 0<span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span>
</code></pre></div><p>Next, we want to increase the score when the player eats a pill, so we update the collision
handler and add a statement to do that. The <code>inc</code> method is a convenience method that
increments (or decrements) an integer game variable.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>    FXGL<span style=color:#f92672>.</span><span style=color:#a6e22e>inc</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;score&#34;</span><span style=color:#f92672>,</span> 10<span style=color:#f92672>);</span>
</code></pre></div><p>The final step is to display the score in the game window. Now we bring back the method
<code>initUI</code> to initialize a label to display the score.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>    <span style=color:#a6e22e>@Override</span>
    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>initUI</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
        Label scoreLabel <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Label<span style=color:#f92672>();</span>
        scoreLabel<span style=color:#f92672>.</span><span style=color:#a6e22e>setTextFill</span><span style=color:#f92672>(</span>Color<span style=color:#f92672>.</span><span style=color:#a6e22e>LIGHTGRAY</span><span style=color:#f92672>);</span>
        scoreLabel<span style=color:#f92672>.</span><span style=color:#a6e22e>setFont</span><span style=color:#f92672>(</span>Font<span style=color:#f92672>.</span><span style=color:#a6e22e>font</span><span style=color:#f92672>(</span>20<span style=color:#f92672>.</span><span style=color:#a6e22e>0</span><span style=color:#f92672>));</span>
        scoreLabel<span style=color:#f92672>.</span><span style=color:#a6e22e>textProperty</span><span style=color:#f92672>().</span><span style=color:#a6e22e>bind</span><span style=color:#f92672>(</span>FXGL<span style=color:#f92672>.</span><span style=color:#a6e22e>getip</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;score&#34;</span><span style=color:#f92672>).</span><span style=color:#a6e22e>asString</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Score: %d&#34;</span><span style=color:#f92672>));</span>
        FXGL<span style=color:#f92672>.</span><span style=color:#a6e22e>addUINode</span><span style=color:#f92672>(</span>scoreLabel<span style=color:#f92672>,</span> 20<span style=color:#f92672>,</span> 10<span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span>
</code></pre></div><p>Here we create a JavaFX label, like we did in the very first, Hello FXGL app. What is new
is that we bind the text property of the label to an integer property that represents the
score game variable, and at the same time transform the integer to a string. This is JavaFX
magic. By binding the label text property to the score integer property, the label text
will be automatically updated whenever the score is updated. No extra code to keep them in
sync, no event handling. JavaFX does it all for you.</p><p>If you run the application again, the maze should be filled with pills, and the score
should be displayed in the top left of the window.</p><p><img src=https://dykstrom.github.io/mazela-man-web/images/03/game-with-score.png alt="Game with Score"></p><p>In the <a href=https://dykstrom.github.io/mazela-man-web/04_animation/>next chapter</a> we will add animation to the game.</p><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=/mazela-man-web/02_physics/ title="02. Physics"><i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=/mazela-man-web/04_animation/ title="04. Animation" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/mazela-man-web/js/clipboard.min.js?1617196794></script><script src=/mazela-man-web/js/perfect-scrollbar.min.js?1617196794></script><script src=/mazela-man-web/js/perfect-scrollbar.jquery.min.js?1617196794></script><script src=/mazela-man-web/js/jquery.sticky.js?1617196794></script><script src=/mazela-man-web/js/featherlight.min.js?1617196794></script><script src=/mazela-man-web/js/highlight.pack.js?1617196794></script><script>hljs.initHighlightingOnLoad()</script><script src=/mazela-man-web/js/modernizr.custom-3.6.0.js?1617196794></script><script src=/mazela-man-web/js/learn.js?1617196794></script><script src=/mazela-man-web/js/hugo-learn.js?1617196794></script><script src=/mazela-man-web/mermaid/mermaid.js?1617196794></script><script>mermaid.initialize({startOnLoad:!0})</script></body></html>